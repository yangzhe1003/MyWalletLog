import{r as j,j as t}from"./index-04b3bc52.js";import{U as K,S as H,D as R,n as w,e as Y}from"./save_excel-cba294db.js";import{a as b,C as G}from"./axios-e82197ab.js";import{C as Q,c as X}from"./index-f96e1400.js";import{F as T,c as N,d as Z,P as L,e as A,T as ee}from"./index-6f8cfe03.js";import{I as F,b as m,P as te}from"./index-53273312.js";import{B as S,E as se}from"./EditOutlined-e142afc2.js";import{L as ae}from"./index-0bfbfb58.js";import{S as ne}from"./index-7257f1a5.js";import{m as re}from"./index-916859b1.js";const z={ethereum:"ETH",dai:"DAI","usd-coin":"USDC",tether:"USDT","wrapped-bitcoin":"WBTC"};async function oe(){const n=`https://api.coingecko.com/api/v3/simple/price?ids=${Object.keys(z).join(",")}&vs_currencies=usd`;try{const o=await b.get(n),i={};for(const s in o.data){const r=z[s];r&&(i[r]=o.data[s].usd)}return i}catch(o){throw new Error("Error fetching token prices:",o.message)}}async function ie(l){let n=1,o=[];const i=await oe();for(;;){const s=`https://voyager.online/api/contract/${l}/transfers?ps=50&p=${n}`,r=await b.get(s),{items:u,lastPage:y}=r.data;if(u.forEach(g=>{const{tx_hash:h,transfer_from:k,transfer_to:x,transfer_value:I,token_symbol:v,token_type:C,token_decimals:$}=g,B={tx_hash:h,transfer_from:k,transfer_to:x,transfer_value:I,token_symbol:v,token_type:C,token_decimals:$,total_value:i.hasOwnProperty(v)?I*i[v]:0};o.push(B)}),y===n)break;n++}return o}async function le(l){let n=[],o=1;for(;;){const s=`https://voyager.online/api/txns?to=${l}&ps=50&p=${o}&type=null`,r=await b.get(s),{items:u,lastPage:y}=r.data;if(u.forEach(g=>{const{actual_fee:h,hash:k,timestamp:x}=g,I={actual_fee:Number(h)/10**18,hash:k,timestamp:x,transfer:[]};n.push(I)}),y===o)break;o++}return(await ie(l)).forEach(s=>{n.forEach(r=>{r.hash===s.tx_hash&&r.transfer.push(s)})}),n}const ce=l=>{const n=new Date(l)*1e3,o=(new Date().getTime()-new Date(n).getTime())/1e3;if(o<60)return Math.round(o)+" 秒前";const i=o/60;if(i<60)return Math.round(i)+" 分前";const s=i/60;if(s<24)return Math.round(s)+" 时前";const r=s/24;return Math.round(r)+" 天前"},de=l=>{const n=l.getFullYear(),o=new Date(n,0,1),i=(l.getDay()+6)%7,s=Math.floor((l.getTime()-o.getTime())/864e5),r=Math.floor((s+o.getDay()-i)/7);return`${n}-${r}`},ue=(l,n)=>{let o=0;const i=new Set,s=new Set,r=new Set;return n.forEach(u=>{const y=new Date(u.timestamp*1e3);o+=u.actual_fee;const g=y.getFullYear(),h=y.getMonth();console.log(`year: ${g}, month: ${h}`);const k=y.getDate(),x=de(y);i.add(`${g} -${h} -${k}`),s.add(`${g} -${x}`),r.add(`${g} -${h}`)}),{fee:o.toFixed(3),days:i.size,weeks:s.size,months:r.size}},me=async(l,n)=>{const{fee:o,days:i,weeks:s,months:r}=ue(l,n),u=n[0],y=ce(u.timestamp)||"无交易";return{fee:o,days:i,weeks:s,months:r,lastTransactionTimeAgo:y}};async function ge(){const n=`https://api.coingecko.com/api/v3/simple/price?ids=${["ethereum","dai","tether","usd-coin","wrapped-bitcoin"].join(",")}&vs_currencies=usd`;let o={},i={ethereum:{sym:0,dec:18},dai:{sym:1,dec:18},"usd-coin":{sym:2,dec:6},tether:{sym:3,dec:6},"wrapped-bitcoin":{sym:4,dec:8}};try{const s=await b.get(n);for(const r in s.data)o[i[r].sym]=s.data[r].usd/10**i[r].dec;return o}catch(s){return console.error("Error fetching token prices:",s.message),null}}async function he(l){try{let n=0,o=0,i=0,s=0,r=1,u=await ge(),y=[];for(;;){const g=await b.get(`https://voyager.online/api/contract/${l}/bridgeTransactions?ps=50&p=${r}`);if(y=[...y,...g.data.items],g.data.lastPage===r||g.data.lastPage===0||g.data.items.length===0)break;r++}return y.forEach(g=>{const{token_id:h,amount:k,type:x}=g;x===0&&(n++,i+=k*u[h]),x===2&&(o++,s+=k*u[h])}),{l1_l2:n,l2_l1:o,l1_l2_amount:Number(i.toFixed(2)),l2_l1_amount:Number(s.toFixed(2))}}catch{return{l1_l2:"-",l2_l1:"-",l1_l2_amount:"-",l2_l1_amount:"-"}}}async function ye(l){try{const n=await b.get(`https://voyager.online/api/contract/${l}`),{classAlias:o,nonce:i}=n.data;return{classAlias:o==="BraavosProxy"?"Braavos":"Argent",nonce:parseInt(i,16)}}catch{return{classAlias:"-",nonce:"-"}}}async function pe(l){try{const n=await b.get(`https://voyager.online/api/contract/${l}/balances`);let o={},i=0;for(const s in n.data){const r=n.data[s].usd.replace("$","");o[n.data[s].symbol]=parseFloat(n.data[s].amount).toFixed(3),i+=Number(r).toFixed(3)}return{...o}}catch{return{ETH:"-",DAI:"-",USDC:"-",USDT:"-",WBTC:"-"}}}const fe=l=>{let n=0;return l.forEach(o=>{const i=o.transfer.sort((r,u)=>parseInt(u.total_value)-parseInt(r.total_value));if(i.length===0)return;const s=parseFloat(i[0].total_value);n+=s}),{volume:n.toFixed(3)}},E=async l=>{let n;try{n=await le(l)}catch{n=[]}const[o,i,s,r]=await Promise.all([me(l,n),he(l),ye(l),pe(l)]),u=fe(n);return{activity:o,bridge:i,account:s,tokenBalance:r,volume:u}};const{TextArea:ke}=F,{Content:xe}=ae,Ce=()=>{const[l,n]=j.useState(!1),[o,i]=j.useState(!1),[s,r]=j.useState([]),[u]=T.useForm(),[y,g]=j.useState(!1),[h,k]=j.useState([]),[x,I]=j.useState(!1),[v]=T.useForm();let C=s.length;j.useEffect(()=>{I(!0);const e=localStorage.getItem("stark_addresses");setTimeout(()=>{I(!1)},500),e&&r(JSON.parse(e))},[]);const $=[{title:"#",key:"index",align:"center",render:(e,a,c)=>c+1},{title:"备注",dataIndex:"name",key:"name",align:"center",className:"name",render:(e,a)=>a.key===W?t.jsx(F,{placeholder:"请输入备注",defaultValue:e,onPressEnter:p=>{a.name=p.target.value,r([...s]),localStorage.setItem("stark_addresses",JSON.stringify(s)),O(null)}}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{color:"blue",children:e}),t.jsx(S,{shape:"circle",icon:t.jsx(se,{}),size:"small",onClick:()=>O(a.key)})]})},{title:"钱包地址",dataIndex:"address",key:"address",align:"center",className:"address",render:(e,a)=>{const c=()=>{X(e),re.success("地址已复制")};return e?t.jsxs(t.Fragment,{children:[e.slice(0,4),"...",e.slice(-4),t.jsx(S,{type:"text",icon:t.jsx(Q,{}),onClick:c,style:{marginLeft:8}})]}):t.jsx(m,{})}},{title:"Type",dataIndex:["account","classAlias"],key:"classAlias",align:"center",render:(e,a)=>e||t.jsx(m,{})},{title:"StarkWare(轻点刷新!不然容易报错)",className:"zksync2",children:[{title:"ETH",dataIndex:["tokenBalance","ETH"],key:"stark_eth_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"USDC",dataIndex:["tokenBalance","USDC"],key:"stark_usdc_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"USDT",dataIndex:["tokenBalance","USDT"],key:"stark_usdt_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"DAI",dataIndex:["tokenBalance","DAI"],key:"stark_dai_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"WBTC",dataIndex:["tokenBalance","WBTC"],key:"stark_wbtc_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"Tx",dataIndex:["account","nonce"],key:"stark_tx_amount",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{}),sorter:(e,a)=>e.account.nonce-a.account.nonce},{title:"最后交易",dataIndex:["activity","lastTransactionTimeAgo"],key:"stark_latest_tx",align:"center",render:(e,a)=>e||e===0?t.jsx("a",{href:`https://voyager.online/contract/${a.address}`,target:"_blank",children:e}):t.jsx(m,{})},{title:"官方桥Tx",className:"stark_cross_tx",children:[{title:"L1->L2",dataIndex:["bridge","l1_l2"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"L2->L1",dataIndex:["bridge","l2_l1"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})}]},{title:"官方桥金额(U)",className:"stark_cross_amount",children:[{title:"L1->L2",dataIndex:["bridge","l1_l2_amount"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"L2->L1",dataIndex:["bridge","l2_l1_amount"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})}]},{title:"活跃统计",className:"stark_activity",children:[{title:"天",dataIndex:["activity","days"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"周",dataIndex:["activity","weeks"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"月",dataIndex:["activity","months"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"金额(U)",dataIndex:["volume","volume"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{}),sorter:(e,a)=>e.volume.volume-a.volume.volume},{title:"fee(E)",dataIndex:["activity","fee"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{}),sorter:(e,a)=>e.activity.fee-a.activity.fee}]},{title:"操作",key:"action",align:"center",render:(e,a)=>t.jsx(ne,{size:"small",children:t.jsx(L,{title:"确认删除？",onConfirm:()=>P(a.key),children:t.jsx(S,{icon:t.jsx(A,{})})})})}]}],B=async()=>{try{const e=await v.validateFields();if(e.address.length!==66&&e.address.length!==64){w.error({message:"错误",description:"请输入正确的stark地址(64位)"},2);return}e.address.startsWith("0x")||(e.address="0x"+e.address),n(!1);const a=s.findIndex(c=>c.address===e.address);if(a!==-1)r(s.map((c,p)=>p===a?{...c,name:e.name}:c)),E(e.address).then(c=>{r(p=>{const d=[...p];return d[a]={...d[a],...c},localStorage.setItem("stark_addresses",JSON.stringify(d)),d})});else{const c={key:s.length.toString(),name:e.name,address:e.address};r(p=>[...p,c]),E(e.address).then(p=>{r(d=>{const f=[...d];return f[f.length-1]={...f[f.length-1],...p},localStorage.setItem("stark_addresses",JSON.stringify(f)),f})})}}catch(e){w.error({message:"错误",description:e.message},2)}finally{v.resetFields()}},P=e=>{r(s.filter(a=>a.key!==e)),localStorage.setItem("stark_addresses",JSON.stringify(s.filter(a=>a.key!==e)))},M=async()=>{try{i(!1);const a=(await u.validateFields()).addresses.split(`
`);for(let c of a){if(c=c.trim(),c.length!==66&&c.length!==64){w.error({message:"错误",description:"请输入正确的stark地址(64位)"});continue}c.startsWith("0x")||(c="0x"+c);const p=s.findIndex(d=>d.address===c);if(p!==-1){const d=await E(c);r(f=>{const _=[...f];return _[p]={..._[p],...d},localStorage.setItem("stark_addresses",JSON.stringify(_)),_})}else{const d={key:C.toString(),address:c};C++,r(_=>[..._,d]);const f=await E(c);r(_=>{const D=[..._];return D[D.length-1]={...D[D.length-1],...f},localStorage.setItem("stark_addresses",JSON.stringify(D)),D})}}}catch(e){w.error({message:"错误",description:e.message})}finally{u.resetFields(),k([])}},U=async()=>{if(!h.length){w.error({message:"错误",description:"请先选择要刷新的地址"},2);return}g(!0);try{for(let e of h){const a=s.findIndex(c=>c.key===e);if(a!==-1){r(p=>{const d=[...p];for(let f in d[a])f!=="address"&&f!=="name"&&f!=="key"&&(d[a][f]=null);return d});const c=await E(s[a].address);r(p=>{const d=[...p];return d[a]={...d[a],...c},localStorage.setItem("stark_addresses",JSON.stringify(d)),d})}}w.success({message:"完成",description:"刷新地址数据完成"},2)}catch(e){w.error({message:"错误",description:e.message},2)}finally{g(!1),k([])}},J=()=>{if(!h.length){w.error({message:"错误",description:"请先选择要删除的地址"},2);return}r(s.filter(e=>!h.includes(e.key))),localStorage.setItem("stark_addresses",JSON.stringify(s.filter(e=>!h.includes(e.key)))),k([])},V=()=>{Y(s,"starkInfo")},[W,O]=j.useState(null),q={selectedRowKeys:h,onChange:e=>{k(e)}};return t.jsx("div",{children:t.jsxs(xe,{children:[t.jsx(N,{title:"批量添加地址",open:o,onOk:M,onCancel:()=>{i(!1),u.resetFields()},okText:"添加地址",cancelText:"取消",width:800,children:t.jsx(T,{form:u,layout:"vertical",children:t.jsx(T.Item,{label:"地址",name:"addresses",rules:[{required:!0}],children:t.jsx(ke,{placeholder:"请输入地址，每行一个",style:{width:"100%",height:"300px",resize:"none"}})})})}),t.jsx(N,{title:"添加地址",open:l,onOk:B,onCancel:()=>n(!1),okText:"添加地址",cancelText:"取消",width:800,children:t.jsxs(T,{form:v,layout:"vertical",children:[t.jsx(T.Item,{label:"地址",name:"address",rules:[{required:!0}],children:t.jsx(F,{placeholder:"请输入地址",style:{width:"100%"}})}),t.jsx(T.Item,{label:"备注",name:"name",children:t.jsx(F,{placeholder:"请输入备注",style:{width:"100%"}})})]})}),t.jsx("div",{style:{marginBottom:"50px"},children:t.jsx(m,{spinning:x,size:"large",children:t.jsx(Z,{rowSelection:q,dataSource:s,pagination:!1,bordered:!0,style:{marginBottom:"20px"},size:"small",columns:$})})}),t.jsx("div",{className:"stark_footer",children:t.jsx(G,{size:"small",style:{width:"100%"},children:t.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[t.jsx(S,{type:"primary",onClick:()=>{n(!0)},size:"large",style:{width:"20%"},icon:t.jsx(te,{}),children:"添加地址"}),t.jsx(S,{type:"primary",onClick:()=>{i(!0)},size:"large",style:{width:"20%"},icon:t.jsx(K,{}),children:"批量添加地址"}),t.jsx(S,{type:"primary",onClick:U,loading:y,size:"large",style:{width:"20%"},icon:t.jsx(H,{}),children:"刷新选中地址"}),t.jsx(L,{title:"确认删除"+h.length+"个地址？",onConfirm:J,children:t.jsx(S,{type:"primary",danger:!0,size:"large",style:{width:"20%"},icon:t.jsx(A,{}),children:"删除选中地址"})}),t.jsx(S,{type:"primary",icon:t.jsx(R,{}),size:"large",style:{width:"8%"},onClick:V})]})})})]})})};export{Ce as default};
